comment: |
  
  Just need to figure out how to handle addresses on one line, then we're ready for testing.
---
mandatory: True
code: |
  interview_metadata # make sure we initialize the object
  if not defined("interview_metadata['A_Plaintiff_Confidential_Information0011']"):
    interview_metadata.initializeObject('A_Plaintiff_Confidential_Information0011')
  interview_metadata['A_Plaintiff_Confidential_Information0011'].update({
    'title': 'Plaintiff Confidential Information Form',
    'short title': 'Plaintiff Confidential Information Form',
    'description': 'Use when filing for a 209A or 258E',
    'original_form': 'https://www.mass.gov/files/documents/2016/08/rd/faha-6.pdf',
    'allowed courts': [
      'Boston Municipal Court',
      'District Court',
      'Probate and Family Court',
      'Superior Court',
    ],
    'preferred court': 'District Court',
    'categories': [
      'Domestic Violence / Safety of self',
      'Family Law',
    ],
    'logic block variable': 'A_Plaintiff_Confidential_Information0011',
    'attachment block variable': 'A_Plaintiff_Confidential_Information0011_attachment',
    'typical role': 'plaintiff',
    'built_in_fields_used': [
      {'variable': 'plaintiff_birthdate',
       'transformed_variable': 'plaintiffs[0].birthdate.format()',
      },
      {'variable': 'plaintiff_name',
       'transformed_variable': 'str(plaintiffs[0])',
      },
      {'variable': 'plaintiff_phone',
       'transformed_variable': 'plaintiffs[0].phone_number',
      },
      {'variable': 'plaintiff_signature',
       'transformed_variable': 'plaintiffs[0].signature',
      },
      {'variable': 'signature_date',
       'transformed_variable': 'signature_date',
      },
      ],
    'fields': [
      {'variable': 'plainitff_address_residential',
       'transformed_variable': 'plainitff_address_residential',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_apartment_yes',
       'transformed_variable': 'plaintiffs[0].apartment_yes',
      'field_type': 'yesno',
      },
      {'variable': 'plaintiff_address_former',
       'transformed_variable': 'plaintiffs[0].address_former',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_workplace_name',
       'transformed_variable': 'plaintiffs[0].workplace_name',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_workplace_address',
       'transformed_variable': 'plaintiffs[0].workplace_address',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_workplace_phone',
       'transformed_variable': 'plaintiffs[0].workplace_phone',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_school_name',
       'transformed_variable': 'plaintiffs[0].school_name',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'plaintiff_school_address',
       'transformed_variable': 'plaintiffs[0].school_address',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'persons_authorized_confidential_information',
       'transformed_variable': 'persons_authorized_confidential_information',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      ],
  })
---
question: |
  Do you need an interpreter?
subquestion: |
  You have the right to an interpreter. 
  
  If your are not 100% confident about speaking English, ask for an interpreter. If there is any chance:
  
  * You may not understand **everything** that is said in English. Or
  * Other people in the hearing will not be able to understand you. 
  Ask.
  
  You do not have to speak only through the interpeter, but you will have one if you need one.
  
fields:
  - I need an interpreter: user_needs_interpreter
    datatype: yesnoradio
  - My preferred language is: user_preferred_language 
    show if: user_needs_interpreter
---
question: |
  Former addresses
subquestion: |
 Did you ever move because ${other_parties.familiar()} was so abusive?
yesno: abuser_caused_plaintiff_to_leave_home
---
question: |
  Are you staying in a domestic violence shelter right now?  
yesno: lives_in_domestic_violence_shelter
---
question: |
  Warning!
subquestion: |
  **Do not write the physical address of the domestic violence shelter anywhere.** 
  
  Most shelters have a P.O. Box you can use if the court needs to contact you or mail you anything.
continue button field: domestic_violence_shelter_warning
---
question: |
  Former addresses
subquestion: |
  Provide any address you recently left to avoid abuse from ${other_parties.familiar()}.

  If you need to add more than one address, click "${word("Add another")}." 
fields: 
  - Address: users[0].previous_addresses[i].address
    address autocomplete: True
  - Unit:     users[0].previous_addresses[i].unit
    required: False
  - City: users[0].previous_addresses[i].city
  - State: users[0].previous_addresses[i].state
    code: |
      states_list()
    default: "MA"    
list collect: True    
---
# question: |
#  When were you born?
# fields:
#  - Your birthdate: users[0].birthdate
#    datatype: date
---
question: |
  Apartment building or multi-family home
yesno: users[0].apartment_yes 
subquestion: |
  Do you live in an apartment building or multi-family home?
---
continue button field: School
question: |
  School
subquestion: |
  If you're a student, provide your school name and address. If you're not a student, tap "Next".
  
  Please don't include your childrens' schools.  There will be another place to give that information.
fields:
  - 'Your school name': users[0].school_name
    required: False
  - 'School address': users[0].school_address
    address autocomplete: True
    required: False
---
continue button field: Who_is_allowed_to_see_this_form
question: |
 Who should be able to see this confidential information?
subquestion: |
  Give the court the names of people who have your permission to see your addresses, phone numbers and email. 
  
  For example, list your lawyer, a domestic violence advocate who is helping you, advocates at a domestic violence program you are working with - really anyone you  need to be able to get this information.
fields:
  - 'Name(s)': persons_authorized_confidential_information
    required: False
    datatype: area
---
continue button field: Workplace
question: |
  Workplace
subquestion: |
  If you have a job, provide your employer's name and contact information. If you do not have a job, tap "Next".
fields:
  - 'Name of your employer/workplace': users[0].workplace_name
    required: False
  - 'Work address': users[0].workplace_address
    required: False
    address autocomplete: True
  - 'Work phone number': users[0].workplace_phone
    required: False
---
progress: 100
#mandatory: True
question: |
  Placeholder download screen
subquestion: |
  Placeholder
  
  ### Next steps
  
  1. Step 1
  1. Step 2
  
  Below is a preview of your form.
  
  ${A_Plaintiff_Confidential_Information0011_attachment }
attachment code: A_Plaintiff_Confidential_Information0011_attachment
---
need: A_Plaintiff_Confidential_Information0011
attachment:
    variable name: A_Plaintiff_Confidential_Information0011_attachment
    name: Plaintiff Confidential Information Form
    filename: Plaintiff_Confidential_Information_Form
    pdf template file: 209A_Plaintiff_Confidential_Information_first_quality_check_ready_for_upload.pdf
    fields: 
      - "plaintiff_birthdate": ${ users[0].birthdate.format() }
      - "plaintiff_name": ${ str(users[0]) }
      - "plaintiff_phone": ${ users[0].mobile_number }
      - plaintiff_phone_home: ${users[0].phone_number }
      - "plaintiff_signature": ${ users[0].signature }
      - "signature_date": ${ signature_date }
      - "plainitff_address_residential": ${ users[0].address.on_one_line(include_unit=True) }
      - "plaintiff_apartment_yes": ${ users[0].apartment_yes }
      - "plaintiff_address_former": ${ users[0].previous_addresses }
      - "plaintiff_workplace_name": ${ users[0].workplace_name }
      - "plaintiff_workplace_address": ${ users[0].workplace_address }
      - "plaintiff_workplace_phone": ${ users[0].workplace_phone }
      - "plaintiff_school_name": ${ users[0].school_name }
      - "plaintiff_school_address": ${ users[0].school_address }
      - "persons_authorized_confidential_information": ${ persons_authorized_confidential_information_cutoff }
      - "plaintiff_needs_interpreter": ${user_needs_interpreter}
      - "plaintiff_preferred_language": ${user_preferred_language if user_needs_interpreter else ''}
---
include:
  - docassemble.MAVirtualCourt:basic-questions.yml
---
id: plaintiff confidential intro
comment: |
  This question is used to introduce your interview. Please customize
continue button field: A_Plaintiff_Confidential_Information0011_intro # SMEs to provide splash page language.
question: |
  Plaintiff confidential information
subquestion: |
  The next questions are about you, including your home, work, and school address. 
  
  The court needs this information to contact you about your case and to make an order that will help keep you as safe as possible.
  
  ${other_parties.familiar()}, ${other_parties.familiar()}â€™s lawyer, and the public are not allowed to see this information about you. Only certain **authorized** people can see it. Even then, they must file a Request for Access to Confidential Information form first, to ask the court's permission.
---
id: interview_order_A_Plaintiff_Confidential_Information0011
code: |
  # This is a placeholder to control logic flow in this interview
  # It was generated from interview_generator.py as an 'interview order' type question.  basic_questions_intro_screen 
  user_role = plaintiff
  A_Plaintiff_Confidential_Information0011_intro
  # Set the preferred/allowed courts for this interview
  # preferred_court = interview_metadata["A_Plaintiff_Confidential_Information0011"]["preferred court"]
  # allowed_courts = interview_metadata["A_Plaintiff_Confidential_Information0011"]["allowed courts"]
  #plainitff_address_residential
  str(users[0])
  if lives_in_domestic_violence_shelter:
    domestic_violence_shelter_warning
  users[0].address.address
  users[0].apartment_yes
  if abuser_caused_plaintiff_to_leave_home:
    users[0].previous_addresses.there_are_any = True
    users[0].previous_addresses.gather()
  else:
    users[0].previous_addresses.there_are_any = False    
  # users[0].apartment_yes
  users[0].birthdate
  users[0].workplace_name 
  users[0].school_name
  Who_is_allowed_to_see_this_form
  user_needs_interpreter
  # users[0].birthdate
  # signature_date
  # By default, we'll mark any un-filled fields as DAEmpty(). This helps avoid errors if you intentionally hide a logic branch or mark a question not required
  # Comment out the line below if you don't want this behavior. 
  # mark_unfilled_fields_empty(interview_metadata["A_Plaintiff_Confidential_Information0011"])
  # A_Plaintiff_Confidential_Information0011_preview_question # Pre-canned preview screen
  # basic_questions_signature_flow
  # users[0].signature
  A_Plaintiff_Confidential_Information0011 = True
---
continue button field: A_Plaintiff_Confidential_Information0011_preview_question
question: |
  Placeholder preview screen
subquestion: |
  Here is a preview of the form you'll sign on the next page. 
  
   ${A_Plaintiff_Confidential_Information0011_attachment_preview}
---
attachment:
    variable name: A_Plaintiff_Confidential_Information0011_attachment_preview
    name: Plaintiff Confidential Information Form
    filename: Plaintiff_Confidential_Information_Form
    pdf template file: 209A_Plaintiff_Confidential_Information_first_quality_check_ready_for_upload.pdf
    fields: 
      - "plaintiff_birthdate": ${ users[0].birthdate.format() }
      - "plaintiff_name": ${ str(users[0]) }
      - "plaintiff_phone": ${ users[0].mobile_number }
      - plaintiff_phone_home: ${users[0].phone_number }
      - "plaintiff_signature": ${ users[0].signature }
      - "signature_date": ${ signature_date }
      #- "plainitff_address_residential": ${ plainitff_address_residential }
      - "plaintiff_apartment_yes": ${ users[0].apartment_yes }
      - "plaintiff_address_former": ${ users[0].previous_addresses }
      - "plaintiff_workplace_name": ${ users[0].workplace_name }
      - "plaintiff_workplace_address": ${ users[0].workplace_address }
      - "plaintiff_workplace_phone": ${ users[0].workplace_phone }
      - "plaintiff_school_name": ${ users[0].school_name }
      - "plaintiff_school_address": ${ users[0].school_address }
      - "persons_authorized_confidential_information": ${ persons_authorized_confidential_information_cutoff }
      - "plaintiff_needs_interpreter": ${user_needs_interpreter}
      - "plaintiff_preferred_language": ${user_preferred_language if user_needs_interpreter else ''} 
---
comment: Addenda related code. 
code: |  
  txtFieldsList_confidential = list()
  if len(users[0].previous_addresses) >= 2:    
    txtFieldsList_confidential.append(
      {'title': 'FORMER ADDRESSES',
      'value': [users[0].previous_addresses]
      })
      
  Limit = 200
  sLimit = Limit - 16   
  need_confidential_info_addendum = len(persons_authorized_confidential_information) > Limit
  if need_confidential_info_addendum:    
    persons_authorized_confidential_information_cutoff = persons_authorized_confidential_information[:sLimit] + " (See Addendum.)"  
    txtFieldsList_confidential.append(
      {'title': 'PERSONS AUTHORIZED BY PLAINTIFF TO HAVE ACCESS TO THIS CONFIDENTIAL INFORMATION',
      'value': [persons_authorized_confidential_information_cutoff]
      })
  else:
    persons_authorized_confidential_information_cutoff = persons_authorized_confidential_information  
  addAddendum_confidential = bool(txtFieldsList_confidential)
  # addAddendum_confidential = False
  # if txtFieldsList_confidential: #if the list is not empty
  #   addAddendum_confidential = True
---
# if: addAddendum_confidential
attachment:
  - variable name: confidential_info_addendum
    docx template file: 209A_confidential_info_addendum.docx
