metadata:
  title: Default playground interview
  short title: Test
  comment: This is a learning tool.  Feel free to write over it.
---
include:
  - basic-questions.yml
---
modules:
  - .upload
---
question: |
  Testing sending emails and viewing submissions
subquestion: |
  The goal of the interview is to test and verify sending completed interviews, as well as verifying that the submissions can be only viewed by authorized individuals.
  
  You will fill out a few extremely short interviews, which we will then send to an email you have provided us.
continue button field: saw_intro
---
question: |
  Where should we send your emails
subquestion: |
  In an actual interview, we would send the email to a court. 
  However, to prevent unnecessary spam, please provide a name and court that we will treat as an actual court.
  
  We will set this fake court as your preferred court. In an actual interview, we would ask you for your preffered court.

  Make sure that you have access to the email you have provided.
fields:
  - Fake court name: fake_court_name
  - Fake court email: fake_court_email
    datatype: email
---
question: |
  Interview 1
subquestion: |
  In this first interview, we will just ask you your name. 
continue button field: saw_interview_1
---
attachment:
  variable name: interveiw_1_attachment
  filename: interveiw_1_attachment
  persistent: True
  private: True
  content: |
    This is interview 1.
    Your name is ${ users[0].name }
---
question: |
  Sending interview 1
subquestion: |
  We have now assembled the first interview.

  ${ interveiw_1_attachment }

  Please press 'continue' to send this email. 
  We will then ask you to verify that you have received the email.
continue button field: send_interview_1
---
question: |
  Results of sending interview 1
subquestion: |
  % if result_1:
    According to our records, the email has been sent successfully!
    Please check the email ${ fake_court_email }.

    You should see the following:

    ```
    Dear ${ fake_court_name }:

    You are receiving 1 file(s) from ${ users[0].name }: 

    interveiw_1_attachment.pdf
    ```

    At the bottom, you should also see a link.
    If you click on the link, it should take you to a page to view submissions/
  % else:
    According to our records, the email did not send successfully.
    
    If you have confirmed that ${ fake_court_email } is a real email, then there is probably a problem with the code.
  % endif

  You can review your subquestion [here](${ url_for_submission(id=submission_id_1) })
continue button field: to_interview_2
---
question: |
  Interview 2
subquestion: |
  Now, let's complete another interview so that we can test sending multiple attachments.
continue button field: saw_interview_2
---
question: |
  Sample question
subquestion: |
  Fill in whatever you want here.
fields:
  - Textbox: interview_2_textbox
    input type: area
---
attachment:
  variable name: interveiw_2_attachment
  filename: interveiw_2_attachment
  persistent: True
  private: True
  content: |
    This is interview 2.
    Your name is ${ users[0].name }.\

    You said ${ interview_2_textbox}
---
question: |
  Sending interview 2
subquestion: |
  We have now assembled the second interview.

  ${ interveiw_2_attachment }

  We will now send you an email containing both interviews.
continue button field: send_interview_2
---
question: |
  Results of sending interview 2
subquestion: |
  % if result_2:
    According to our records, the email has been sent successfully!
    Please check the email ${ fake_court_email }.

    You should see the following:

    ```
    Dear ${ fake_court_name }:

    You are receiving 2 file(s) from ${ users[0].name }: 

    interveiw_1_attachment.pdf
    
    interveiw_2_attachment.pdf
    ```

    At the bottom, you should also see a link.
    If you click on the link, it should take you to a page to view submissions/
  % else:
    According to our records, the email did not send successfully.
    
    If you have confirmed that ${ fake_court_email } is a real email, then there is probably a problem with the code.
  % endif

  You can review your subquestion [here](${ url_for_submission(id=submission_id_1) })
continue button field: to_interview_3
---
mandatory: True
code: |
  saw_intro
  court_emails[fake_court_name] = fake_court_email
  emails_to_courts = reverse_dictionary(court_emails)

  saw_interview_1
  users[0].name
  interveiw_1_attachment
  send_interview_1

  files = [interveiw_1_attachment.pdf]
  name = str(users[0].name)
  
  submission_id_1 = new_entry(court_emails=court_emails, court_name=fake_court_name, name=name, files=files)
  result_1 = send_attachments(name=name, court_name=fake_court_name, court_emails=court_emails, files=files, submission_id=submission_id_1)
  
  to_interview_2
  saw_interview_2
  interview_2_textbox
  interveiw_2_attachment
  send_interview_2

  files = [interveiw_1_attachment.pdf, interveiw_2_attachment.pdf]

  submission_id_2 = new_entry(court_emails=court_emails, court_name=fake_court_name, name=name, files=files)
  result_2 = send_attachments(name=name, court_name=fake_court_name, court_emails=court_emails, files=files, submission_id=submission_id_2)

  to_interview_3
